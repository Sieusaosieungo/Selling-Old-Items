{"version":3,"sources":["pages/Profile/index.js"],"names":["Option","Select","connect","user","withCookies","cookies","dispatch","useState","userInfo","setUserInfo","disabled","setDisabled","changePassword","setChangePassword","accessToken","onChange","e","target","name","value","gender","useEffect","className","src","avatar","config","API_IMAGES","IMAGE_USER_DEFAULT","alt","type","required","preventDefault","formData","FormData","append","files","axios","method","url","API_URL","headers","authorization","data","then","res","storeUser","results","message","success","catch","err","error","full_name","email","student_id","phone","address","checked","onClick","oldPassword","warning","newPassword","confirmNewPassword","JSON","stringify"],"mappings":"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","file":"static/js/15.2c59da7a.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Input, DatePicker, Button, message, Select, Checkbox } from 'antd';\r\nimport { connect } from 'react-redux';\r\nimport axios from 'axios';\r\nimport { withCookies } from 'react-cookie';\r\n\r\nimport './style.scss';\r\n\r\nimport config from '../../utils/config';\r\nimport { storeUser } from '../../actions';\r\n\r\nconst { Option } = Select;\r\n\r\nconst prefixCls = 'profile';\r\n\r\nconst Profile = ({ user, cookies, dispatch }) => {\r\n  const [userInfo, setUserInfo] = useState({});\r\n  const [disabled, setDisabled] = useState(true);\r\n  const [changePassword, setChangePassword] = useState(false);\r\n\r\n  const { accessToken } = cookies.cookies;\r\n\r\n  const onChange = e => {\r\n    if (e.target) {\r\n      const { name, value } = e.target;\r\n      setUserInfo({ ...userInfo, [name]: value });\r\n    } else {\r\n      setUserInfo({ ...userInfo, gender: e });\r\n    }\r\n  };\r\n\r\n  const handleChangePassword = e => setChangePassword(e.target.checked);\r\n\r\n  const cancelUpdate = () => {\r\n    setChangePassword(false);\r\n    setDisabled(true);\r\n  };\r\n\r\n  const updateUserInfo = () => {\r\n    if (disabled) {\r\n      setDisabled(false);\r\n    }\r\n\r\n    if (changePassword) {\r\n      if (!userInfo.oldPassword) {\r\n        return message.warning('Không được bỏ trống mật khẩu cũ !');\r\n      }\r\n\r\n      if (userInfo.oldPassword && !userInfo.newPassword) {\r\n        return message.warning('Không được bỏ trống mật khẩu mới');\r\n      }\r\n\r\n      if (userInfo.newPassword && !userInfo.confirmNewPassword) {\r\n        return message.warning('Không được bỏ trống xác nhận mật khẩu mới');\r\n      }\r\n    }\r\n\r\n    if (JSON.stringify(userInfo) !== JSON.stringify(user)) {\r\n      delete userInfo.email;\r\n      delete userInfo.student_id;\r\n\r\n      axios({\r\n        method: 'PATCH',\r\n        url: `${config.API_URL}/users`,\r\n        headers: {\r\n          authorization: `Bearer ${accessToken}`,\r\n        },\r\n        data: userInfo,\r\n      })\r\n        .then(res => {\r\n          if (res.data.results.user) {\r\n            dispatch(storeUser(res.data.results.user));\r\n            setChangePassword(false);\r\n            setDisabled(true);\r\n            message.success('Đổi thông tin thành công !');\r\n          }\r\n        })\r\n        .catch(err => message.error('Đổi thông tin không thành công !'));\r\n    }\r\n  };\r\n\r\n  const handleChangeUploadAvatar = e => {\r\n    e.preventDefault();\r\n    const formData = new FormData();\r\n    formData.append('avatar', e.target.files[0]);\r\n\r\n    axios({\r\n      method: 'PATCH',\r\n      url: `${config.API_URL}/users/upload-avatar`,\r\n      headers: {\r\n        authorization: `Bearer ${accessToken}`,\r\n      },\r\n      data: formData,\r\n    })\r\n      .then(res => {\r\n        dispatch(storeUser(res.data.results.user));\r\n        message.success('Cập nhật ảnh thành công');\r\n      })\r\n      .catch(err => message.error('Cập nhật ảnh thất bại'));\r\n  };\r\n\r\n  useEffect(() => {\r\n    setUserInfo(user);\r\n  }, [user]);\r\n\r\n  return (\r\n    <div className={`${prefixCls}`}>\r\n      <div className={`${prefixCls}-avatar`}>\r\n        <div className={`${prefixCls}-avatar-img`}>\r\n          <img\r\n            src={\r\n              user.avatar\r\n                ? `${config.API_IMAGES}${user.avatar}`\r\n                : config.IMAGE_USER_DEFAULT\r\n            }\r\n            alt=\"avatar\"\r\n          />\r\n        </div>\r\n        <div className={`${prefixCls}-upload-btn`}>\r\n          <label className=\"upload-btn-wrapper\">\r\n            <input\r\n              type=\"file\"\r\n              required\r\n              onChange={handleChangeUploadAvatar}\r\n              name=\"avatar\"\r\n            />\r\n            <span>Chọn ảnh</span>\r\n          </label>\r\n        </div>\r\n      </div>\r\n      <div className={`${prefixCls}-info`}>\r\n        <div className={`${prefixCls}-name`}>\r\n          <span>Họ tên:</span>\r\n          <Input\r\n            value={userInfo.full_name}\r\n            name=\"full_name\"\r\n            onChange={onChange}\r\n            disabled={disabled}\r\n          />\r\n        </div>\r\n        <div className={`${prefixCls}-email`}>\r\n          <span>Email:</span>\r\n          <Input\r\n            value={userInfo.email}\r\n            name=\"email\"\r\n            onChange={onChange}\r\n            disabled\r\n          />\r\n        </div>\r\n        <div className={`${prefixCls}-gender`}>\r\n          <span>Giới tính:</span>\r\n          <Select\r\n            name=\"gender\"\r\n            value={`${userInfo.gender}`}\r\n            onChange={onChange}\r\n            disabled={disabled}\r\n          >\r\n            <Option value=\"male\">Male</Option>\r\n            <Option value=\"female\">Female</Option>\r\n          </Select>\r\n        </div>\r\n        <div className={`${prefixCls}-student-id`}>\r\n          <span>Mã sinh viên:</span>\r\n          <Input value={userInfo.student_id} onChange={onChange} disabled />\r\n        </div>\r\n        <div className={`${prefixCls}-phone`}>\r\n          <span>Sđt:</span>\r\n          <Input\r\n            value={userInfo.phone}\r\n            name=\"phone\"\r\n            onChange={onChange}\r\n            disabled={disabled}\r\n          />\r\n        </div>\r\n        <div className={`${prefixCls}-address`}>\r\n          <span>Địa chỉ:</span>\r\n          <Input\r\n            value={userInfo.address}\r\n            name=\"address\"\r\n            onChange={onChange}\r\n            disabled={disabled}\r\n          />\r\n        </div>\r\n        {!disabled && (\r\n          <div className={`${prefixCls}-checkbox`}>\r\n            <span>Đổi mật khẩu:</span>\r\n            <Checkbox onChange={handleChangePassword} />\r\n          </div>\r\n        )}\r\n        {changePassword && (\r\n          <div className={`${prefixCls}-old-password`}>\r\n            <span>Mật khẩu cũ (*):</span>\r\n            <Input type=\"password\" onChange={onChange} name=\"oldPassword\" />\r\n          </div>\r\n        )}\r\n        {changePassword && (\r\n          <div className={`${prefixCls}-new-password`}>\r\n            <span>Mật khẩu mới:</span>\r\n            <Input type=\"password\" onChange={onChange} name=\"newPassword\" />\r\n          </div>\r\n        )}\r\n        {changePassword && (\r\n          <div className={`${prefixCls}-confirm-new-password`}>\r\n            <span>Xác nhận mật khẩu mới:</span>\r\n            <Input\r\n              type=\"password\"\r\n              onChange={onChange}\r\n              name=\"confirmNewPassword\"\r\n            />\r\n          </div>\r\n        )}\r\n        <div className={`${prefixCls}-button`}>\r\n          <Button\r\n            type=\"primary\"\r\n            onClick={updateUserInfo}\r\n            className={`${prefixCls}-${!disabled ? 'btn-update' : 'btn'}`}\r\n          >\r\n            Cập nhật thông tin\r\n          </Button>\r\n          {!disabled && (\r\n            <Button\r\n              type=\"danger\"\r\n              className={`${prefixCls}-btn-cancel`}\r\n              onClick={cancelUpdate}\r\n            >\r\n              Hủy\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = ({ user }) => {\r\n  return { user };\r\n};\r\n\r\nexport default connect(mapStateToProps)(withCookies(Profile));\r\n"],"sourceRoot":""}